<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ordenando N칰meros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Importaci칩n de la fuente subida */
        @font-face {
            font-family: 'Escolar';
            src: url('Escolar_N.TTF');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Escolar', 'Comic Sans MS', sans-serif;
            background-color: #f0f9ff;
            overflow: hidden; /* Evitar scroll */
            touch-action: none; /* Mejorar respuesta t치ctil */
            user-select: none;
        }

        /* Estilos para los n칰meros arrastrables */
        .draggable-item {
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
            touch-action: none;
        }

        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.05);
            z-index: 50;
        }

        .draggable-item.dragging {
            opacity: 0.5;
            border: 4px dashed #cbd5e1;
        }

        /* Estados de correcci칩n */
        .correct {
            background-color: #dcfce7 !important; /* Verde claro */
            border-color: #22c55e !important;
            box-shadow: 0 0 15px #22c55e;
            animation: bounce 0.5s;
        }

        .incorrect {
            background-color: #fee2e2 !important; /* Rojo claro */
            border-color: #ef4444 !important;
            box-shadow: 0 0 15px #ef4444;
            animation: shake 0.5s;
        }

        /* Animaciones */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Estilo para los inputs de rango */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #bfdbfe;
            border-radius: 5px;
        }

        /* Contenedor principal de los n칰meros */
        #game-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            min-height: 50vh;
            padding: 1rem;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col bg-sky-100 text-slate-800">

    <!-- BARRA SUPERIOR (CONFIGURACI칍N) -->
    <header class="bg-white shadow-md p-2 z-10 flex-none">
        <div class="max-w-7xl mx-auto flex flex-wrap justify-between items-center gap-2 text-sm md:text-base">
            
            <!-- T칤tulo -->
            <div class="hidden md:block font-bold text-xl text-blue-600 mr-4">
                <i class="fas fa-shapes"></i> Ordenando
            </div>

            <!-- Controles -->
            <div class="flex flex-1 flex-wrap justify-center items-center gap-4 bg-blue-50 rounded-xl p-2 border border-blue-200">
                
                <!-- Rango M치ximo -->
                <div class="flex flex-col items-center min-w-[100px]">
                    <label class="font-bold text-gray-600 text-xs mb-1">M치ximo</label>
                    <input type="number" id="max-selector" min="2" max="999" value="99" class="bg-white border border-blue-300 rounded-lg px-2 py-1 text-center font-bold text-blue-600 text-lg outline-none focus:ring-2 focus:ring-blue-400 w-24 shadow-sm" placeholder="99">
                </div>

                <!-- Cantidad de N칰meros -->
                <div class="flex flex-col items-center min-w-[100px]">
                    <label class="font-bold text-gray-600 text-xs">Cantidad: <span id="qty-val-display" class="text-blue-600 text-lg">5</span></label>
                    <input type="range" id="qty-selector" min="2" max="10" value="5" class="w-24">
                </div>

                <!-- Direcci칩n (Mayor/Menor) -->
                <div class="flex flex-col items-center">
                    <label class="font-bold text-gray-600 text-xs mb-1">Orden</label>
                    <button id="order-toggle" class="flex items-center gap-2 bg-white border-2 border-blue-400 px-3 py-1 rounded-full shadow-sm hover:bg-blue-50 transition-colors">
                        <!-- Icono din치mico -->
                        <div id="order-icon" class="flex items-end gap-1 h-6">
                            <!-- Se llena por JS -->
                        </div>
                        <span id="order-text" class="font-bold text-xs md:text-sm">Mayor a Menor</span>
                    </button>
                </div>

            </div>

            <!-- Bot칩n Pantalla Completa -->
            <button onclick="toggleFullScreen()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-3 rounded-full shadow transition w-10 h-10 flex items-center justify-center">
                <i class="fas fa-expand"></i>
            </button>
        </div>
    </header>

    <!-- 츼REA DE JUEGO -->
    <main class="flex-grow flex flex-col justify-center items-center relative overflow-hidden">
        
        <!-- Instrucci칩n visual grande -->
        <div id="instruction-overlay" class="absolute top-4 left-0 right-0 text-center pointer-events-none opacity-50">
            <h2 class="text-3xl md:text-5xl font-bold text-blue-200 tracking-widest uppercase opacity-20 select-none">ARRASTRA</h2>
        </div>

        <!-- Contenedor de n칰meros (Drop Zone) -->
        <div id="game-board" class="w-full max-w-6xl transition-all">
            <!-- Los n칰meros se generar치n aqu칤 -->
        </div>

    </main>

    <!-- BARRA INFERIOR (ACCIONES) -->
    <footer class="bg-white p-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] flex justify-center gap-6 z-20">
        
        <button onclick="initGame()" class="flex flex-col items-center justify-center gap-1 bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-6 rounded-2xl shadow-lg transform hover:scale-105 transition active:scale-95 border-b-4 border-yellow-600">
            <i class="fas fa-sync-alt text-2xl"></i>
            <span>NUEVO</span>
        </button>

        <button onclick="checkAnswer()" class="flex flex-col items-center justify-center gap-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition active:scale-95 border-b-4 border-green-700">
            <i class="fas fa-check text-2xl"></i>
            <span>CORREGIR</span>
        </button>

    </footer>

    <!-- MODAL DE MENSAJE -->
    <div id="message-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-8 text-center shadow-2xl border-4 border-blue-400 max-w-sm w-full mx-4 transform scale-100 animate-[bounce_0.5s_ease-out]">
            <div id="modal-icon" class="text-6xl mb-4">游꿀</div>
            <h2 id="modal-title" class="text-3xl font-bold text-blue-600 mb-2">춰Muy bien!</h2>
            <p id="modal-text" class="text-gray-600 text-lg mb-6">Lo has ordenado perfectamente.</p>
            <button onclick="closeModal()" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-full text-xl shadow-md hover:bg-blue-600 w-full">
                Continuar
            </button>
        </div>
    </div>

    <!-- AUDIO (Efectos simples usando Web Audio API en JS, no archivos externos para asegurar que funcione siempre) -->

    <script>
        // --- ESTADO DE LA APP ---
        const state = {
            maxNumber: 99,
            quantity: 5,
            orderDesc: true, // true = Mayor a Menor, false = Menor a Mayor
            numbers: [],
            isDragging: false
        };

        // --- REFERENCIAS DOM ---
        const maxSelector = document.getElementById('max-selector');
        const qtySelector = document.getElementById('qty-selector');
        const qtyDisplay = document.getElementById('qty-val-display');
        // const maxDisplay eliminado ya que el input muestra el valor
        const orderToggle = document.getElementById('order-toggle');
        const gameBoard = document.getElementById('game-board');
        const modal = document.getElementById('message-modal');

        // --- INICIALIZACI칍N Y EVENTOS ---
        
        // Configurar selector de cantidad
        qtySelector.addEventListener('input', (e) => {
            state.quantity = parseInt(e.target.value);
            qtyDisplay.textContent = state.quantity;
            initGame();
        });

        // Configurar selector de m치ximo (Input num칠rico libre)
        maxSelector.addEventListener('change', (e) => {
            let val = parseInt(e.target.value);
            
            // Validaciones de seguridad
            if (isNaN(val) || val < 2) val = 2;
            if (val > 999) val = 999;
            
            // Actualizar input visualmente si fue corregido
            e.target.value = val;
            
            state.maxNumber = val;
            initGame();
        });

        // Tambi칠n al escribir (para feedback r치pido si se desea, aunque 'change' es mejor para no refrescar constantemente mientras se escribe)
        // Usamos 'blur' impl칤cito en change, pero a침adimos input para validar longitud si se desea.

        // Toggle Orden
        orderToggle.addEventListener('click', () => {
            state.orderDesc = !state.orderDesc;
            updateOrderUI();
            // No reiniciamos el juego, solo cambiamos la meta visual, el ni침o tiene que reordenar
            // Opcional: initGame() si queremos que se mezclen de nuevo. Mejor no, para que solo cambie la instrucci칩n.
            updateInstructionOverlay();
        });

        function updateOrderUI() {
            const iconContainer = document.getElementById('order-icon');
            const textDisplay = document.getElementById('order-text');
            
            iconContainer.innerHTML = '';
            
            if (state.orderDesc) {
                // Mayor a Menor (Grande a Peque침o)
                textDisplay.textContent = "Mayor a Menor";
                iconContainer.innerHTML = `
                    <div class="w-2 h-5 bg-blue-600 rounded-sm"></div>
                    <div class="w-2 h-3 bg-blue-400 rounded-sm"></div>
                    <div class="w-2 h-1 bg-blue-200 rounded-sm"></div>
                    <i class="fas fa-arrow-right text-gray-400 text-xs ml-1 self-center"></i>
                `;
            } else {
                // Menor a Mayor (Peque침o a Grande)
                textDisplay.textContent = "Menor a Mayor";
                iconContainer.innerHTML = `
                    <div class="w-2 h-1 bg-blue-200 rounded-sm"></div>
                    <div class="w-2 h-3 bg-blue-400 rounded-sm"></div>
                    <div class="w-2 h-5 bg-blue-600 rounded-sm"></div>
                    <i class="fas fa-arrow-right text-gray-400 text-xs ml-1 self-center"></i>
                `;
            }
        }

        function updateInstructionOverlay() {
            // Actualizar flechas visuales o pistas si fuera necesario
        }

        // --- L칍GICA DEL JUEGO ---

        function generateRandomNumbers() {
            const nums = new Set();
            while(nums.size < state.quantity) {
                const n = Math.floor(Math.random() * (state.maxNumber + 1));
                nums.add(n);
            }
            return Array.from(nums);
        }

        // Funci칩n para colorear d칤gitos (Montessori)
        function colorizeNumber(num) {
            const str = num.toString();
            let html = '';
            const len = str.length;
            
            // Azul: Unidades, Rojo: Decenas, Verde: Centenas
            for (let i = 0; i < len; i++) {
                const digit = str[i];
                const place = len - 1 - i; // 0 = unidades, 1 = decenas, 2 = centenas
                
                let colorClass = 'text-gray-800'; // Default
                if (place === 0) colorClass = 'text-blue-600'; // Unidades
                else if (place === 1) colorClass = 'text-red-500'; // Decenas
                else if (place === 2) colorClass = 'text-green-600'; // Centenas
                
                html += `<span class="${colorClass}">${digit}</span>`;
            }
            return html;
        }

        function initGame() {
            gameBoard.innerHTML = '';
            state.numbers = generateRandomNumbers();
            
            // Crear elementos DOM
            state.numbers.forEach(num => {
                const el = document.createElement('div');
                el.className = 'draggable-item bg-white border-4 border-blue-200 rounded-2xl shadow-lg flex items-center justify-center text-4xl md:text-6xl font-bold select-none relative';
                
                // Dimensiones responsivas
                // Calculamos un tama침o base dependiendo de la cantidad para que quepan bien
                const sizeClass = state.quantity > 6 ? 'w-20 h-24 md:w-28 md:h-36' : 'w-24 h-32 md:w-36 md:h-48';
                el.className += ` ${sizeClass}`;
                
                el.innerHTML = colorizeNumber(num);
                el.dataset.value = num;
                el.setAttribute('draggable', 'true'); // Nativo para escritorio

                // Eventos Drag & Drop
                addDragEvents(el);

                gameBoard.appendChild(el);
            });

            // Eliminar clases de correcci칩n anteriores
            closeModal();
        }

        // --- SISTEMA DE ARRASTRAR Y SOLTAR (Touch + Mouse) ---

        let dragSrcEl = null;

        function addDragEvents(el) {
            // Eventos de Rat칩n (Desktop est치ndar)
            el.addEventListener('dragstart', handleDragStart);
            el.addEventListener('dragover', handleDragOver);
            el.addEventListener('dragenter', handleDragEnter);
            el.addEventListener('dragleave', handleDragLeave);
            el.addEventListener('drop', handleDrop);
            el.addEventListener('dragend', handleDragEnd);

            // Eventos T치ctiles (M칩vil/Tablet)
            el.addEventListener('touchstart', handleTouchStart, {passive: false});
            el.addEventListener('touchmove', handleTouchMove, {passive: false});
            el.addEventListener('touchend', handleTouchEnd);
        }

        function handleDragStart(e) {
            this.style.opacity = '0.4';
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            this.classList.add('scale-110', 'border-blue-500');
        }

        function handleDragLeave(e) {
            this.classList.remove('scale-110', 'border-blue-500');
        }

        function handleDrop(e) {
            if (e.stopPropagation) e.stopPropagation();

            if (dragSrcEl !== this) {
                // Intercambio de contenido y valor
                const srcVal = dragSrcEl.dataset.value;
                const srcHTML = dragSrcEl.innerHTML;
                
                const destVal = this.dataset.value;
                const destHTML = this.innerHTML;

                dragSrcEl.innerHTML = destHTML;
                dragSrcEl.dataset.value = destVal;

                this.innerHTML = srcHTML;
                this.dataset.value = srcVal;
                
                playSound('pop');
            }
            return false;
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
            [].forEach.call(document.querySelectorAll('.draggable-item'), function (col) {
                col.classList.remove('scale-110', 'border-blue-500');
            });
        }

        // --- L칍GICA T츼CTIL (Simulaci칩n de Drag & Drop) ---
        // Para m칩viles es mejor un enfoque de "agarrar" y mover f칤sicamente el elemento
        // O un enfoque de "swap" (tocar uno, tocar otro). 
        // Implementaremos "Swap" (tocar para seleccionar, tocar otro para cambiar) porque es m치s accesible para ni침os peque침os que arrastrar con precisi칩n en pantallas peque침as.

        let selectedTouchEl = null;

        function handleTouchStart(e) {
            // Evitar scroll
            if(e.target.closest('.draggable-item')) {
                // e.preventDefault(); // Comentado para permitir tap simple si fuera necesario, pero necesitamos evitar scroll
            }
            
            const el = this;
            
            if (!selectedTouchEl) {
                // Seleccionar primero
                selectedTouchEl = el;
                el.classList.add('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                playSound('select');
            } else {
                if (selectedTouchEl === el) {
                    // Deseleccionar si toco el mismo
                    selectedTouchEl.classList.remove('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                    selectedTouchEl = null;
                } else {
                    // Intercambiar con el segundo
                    const srcVal = selectedTouchEl.dataset.value;
                    const srcHTML = selectedTouchEl.innerHTML;
                    
                    const destVal = el.dataset.value;
                    const destHTML = el.innerHTML;

                    selectedTouchEl.innerHTML = destHTML;
                    selectedTouchEl.dataset.value = destVal;
                    selectedTouchEl.classList.remove('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');

                    el.innerHTML = srcHTML;
                    el.dataset.value = srcVal;
                    
                    // Efecto visual de cambio
                    el.classList.add('scale-110');
                    setTimeout(() => el.classList.remove('scale-110'), 200);

                    playSound('pop');
                    selectedTouchEl = null;
                }
            }
        }

        function handleTouchMove(e) {
           // Prevenir scroll mientras se interact칰a con las fichas
           e.preventDefault(); 
        }

        function handleTouchEnd(e) {
            // Nada espec칤fico, la l칩gica est치 en start para el modelo Swap
        }


        // --- CORRECCI칍N ---

        function checkAnswer() {
            const currentElements = Array.from(gameBoard.children);
            const currentValues = currentElements.map(el => parseInt(el.dataset.value));
            
            // Crear copia y ordenar seg칰n configuraci칩n
            const sortedValues = [...currentValues].sort((a, b) => {
                return state.orderDesc ? b - a : a - b;
            });

            let errors = 0;

            currentElements.forEach((el, index) => {
                const val = parseInt(el.dataset.value);
                // Limpiar clases previas
                el.classList.remove('correct', 'incorrect');
                
                // Forzar reflow para reiniciar animaci칩n
                void el.offsetWidth;

                if (val === sortedValues[index]) {
                    el.classList.add('correct');
                } else {
                    el.classList.add('incorrect');
                    errors++;
                }
            });

            if (errors === 0) {
                playSound('success');
                showModal('춰Fant치stico!', 'Has ordenado todos los n칰meros correctamente.', '游꿀');
            } else {
                playSound('error');
            }
        }

        // --- UTILIDADES ---

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function showModal(title, text, icon) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-text').innerText = text;
            document.getElementById('modal-icon').innerText = icon;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        // Sintetizador de audio simple
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'select') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'success') {
                // Acorde simple
                const frequencies = [523.25, 659.25, 783.99]; // Do Mi Sol
                frequencies.forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.type = 'sine';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.2, audioCtx.currentTime + (i*0.1));
                    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6 + (i*0.1));
                    o.start(audioCtx.currentTime + (i*0.1));
                    o.stop(audioCtx.currentTime + 0.6 + (i*0.1));
                });
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // Arrancar
        updateOrderUI();
        initGame();

    </script>
</body>
</html>