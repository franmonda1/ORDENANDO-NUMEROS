<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ordenando NÃºmeros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ImportaciÃ³n de la fuente subida */
        @font-face {
            font-family: 'Escolar';
            src: url('Escolar_N.TTF');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            /* Variable CSS para controlar la altura real visible en mÃ³viles */
            --app-height: 100dvh;
        }

        body {
            font-family: 'Escolar', 'Comic Sans MS', sans-serif;
            background-color: #f0f9ff;
            /* USAMOS 100dvh para que descuente las barras del navegador en mÃ³vil */
            height: var(--app-height);
            width: 100vw;
            overflow: hidden; /* Evitar scroll global */
            touch-action: none; /* Mejorar respuesta tÃ¡ctil */
            user-select: none;
            display: flex;
            flex-direction: column;
        }

        /* Estilos para los nÃºmeros arrastrables */
        .draggable-item {
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
            touch-action: none;
            /* Flexbox centrado */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.05);
            z-index: 50;
        }

        .draggable-item.dragging {
            opacity: 0.5;
            border: 4px dashed #cbd5e1;
        }

        /* Estados de correcciÃ³n */
        .correct {
            background-color: #dcfce7 !important; /* Verde claro */
            border-color: #22c55e !important;
            box-shadow: 0 0 15px #22c55e;
            animation: bounce 0.5s;
        }

        .incorrect {
            background-color: #fee2e2 !important; /* Rojo claro */
            border-color: #ef4444 !important;
            box-shadow: 0 0 15px #ef4444;
            animation: shake 0.5s;
        }

        /* Animaciones */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Inputs Range Personalizados */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px; 
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -5px; 
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #bfdbfe;
            border-radius: 5px;
        }

        /* Contenedor principal de los nÃºmeros */
        #game-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            align-content: center;
            gap: 1rem;
            padding: 0.5rem;
            width: 100%;
            height: 100%; 
        }

        /* OPTIMIZACIÃ“N MÃ“VIL LANDSCAPE (Altura reducida) */
        @media (max-height: 500px) and (orientation: landscape) {
            header {
                padding: 2px !important;
            }
            .header-controls {
                padding: 1px 8px !important;
                gap: 10px !important;
            }
            .control-label {
                display: none !important;
            }
            /* Forzar barra inferior muy fina */
            footer {
                padding: 2px 4px !important;
                height: 40px !important; 
                min-height: 0 !important;
            }
            .action-btn {
                padding: 2px 12px !important;
                height: 30px !important;
                font-size: 0.8rem !important;
                border-bottom-width: 2px !important;
            }
            .action-btn i {
                font-size: 0.9rem !important;
            }
            /* Fichas compactas para que quepan verticalmente */
            .draggable-item {
                width: 3rem !important; 
                height: 4rem !important;
                font-size: 1.5rem !important;
                border-width: 2px !important;
                margin: 0 2px !important;
            }
            #instruction-overlay h2 {
                font-size: 2rem !important;
                opacity: 0.1 !important;
            }
            #game-board {
                gap: 0.25rem;
            }
        }
    </style>
</head>
<body class="bg-sky-100 text-slate-800">

    <!-- BARRA SUPERIOR (CONFIGURACIÃ“N) -->
    <header class="bg-white shadow-sm p-2 z-10 flex-none relative">
        <div class="max-w-7xl mx-auto flex justify-between items-center gap-2">
            
            <!-- TÃ­tulo (Solo Desktop/Tablet grande) -->
            <div class="hidden lg:block font-bold text-2xl text-blue-600 mr-4 whitespace-nowrap drop-shadow-sm">
                <i class="fas fa-shapes"></i> Ordenando
            </div>

            <!-- Controles -->
            <div class="header-controls flex flex-1 flex-wrap justify-center items-center gap-3 bg-blue-50 rounded-xl px-4 py-1 border border-blue-200 shadow-inner">
                
                <!-- MÃ¡ximo -->
                <div class="flex flex-col items-center justify-center">
                    <label class="control-label font-bold text-gray-500 text-[10px] uppercase tracking-wide">MÃ¡ximo</label>
                    <input type="number" id="max-selector" min="2" max="999" value="99" 
                           class="bg-white border border-blue-300 rounded-lg px-2 py-0.5 text-center font-bold text-blue-600 text-lg outline-none focus:ring-2 focus:ring-blue-400 w-20 shadow-sm transition-all hover:border-blue-400">
                </div>

                <div class="h-8 w-px bg-blue-200 mx-1 hidden sm:block"></div>

                <!-- Cantidad -->
                <div class="flex flex-col items-center justify-center min-w-[90px]">
                    <label class="control-label font-bold text-gray-500 text-[10px] uppercase tracking-wide">
                        Cant: <span id="qty-val-display" class="text-blue-600 text-sm">5</span>
                    </label>
                    <input type="range" id="qty-selector" min="2" max="10" value="5" class="w-24">
                </div>

                <div class="h-8 w-px bg-blue-200 mx-1 hidden sm:block"></div>

                <!-- Orden -->
                <div class="flex flex-col items-center justify-center">
                    <label class="control-label font-bold text-gray-500 text-[10px] uppercase tracking-wide">Orden</label>
                    <button id="order-toggle" class="flex items-center gap-2 bg-white border border-blue-300 px-3 py-1 rounded-full shadow-sm hover:bg-blue-100 hover:shadow active:scale-95 transition-all">
                        <div id="order-icon" class="flex items-end gap-1 h-5"></div>
                        <span id="order-text" class="hidden sm:inline font-bold text-xs text-blue-800">Mayor a Menor</span>
                    </button>
                </div>

            </div>

            <!-- BotÃ³n Pantalla Completa (Discreto) -->
            <button onclick="toggleFullScreen()" class="flex-none bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-blue-600 p-2 rounded-lg transition w-10 h-10 flex items-center justify-center" title="Pantalla Completa">
                <i class="fas fa-expand text-lg"></i>
            </button>
        </div>
    </header>

    <!-- ÃREA DE JUEGO (Flex Grow + Min-Height 0 para evitar desbordamientos) -->
    <main class="flex-grow flex flex-col justify-center items-center relative overflow-hidden w-full bg-gradient-to-b from-sky-50 to-sky-100 min-h-0">
        
        <!-- Marca de agua / InstrucciÃ³n -->
        <div id="instruction-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
            <h2 class="text-[10vw] font-bold text-blue-200 tracking-widest uppercase opacity-20 select-none transform -rotate-6">ARRASTRA</h2>
        </div>

        <!-- Tablero -->
        <div id="game-board" class="z-10 relative">
            <!-- NÃºmeros generados aquÃ­ -->
        </div>

    </main>

    <!-- BARRA INFERIOR (Flex Shrink 0 para evitar que se aplaste o desaparezca) -->
    <footer class="bg-white border-t border-blue-100 p-2 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] z-20 flex-none h-auto min-h-[50px] flex items-center justify-center gap-4 transition-all shrink-0">
        
        <!-- BotÃ³n Nuevo -->
        <button onclick="initGame()" class="action-btn flex items-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-1.5 px-6 rounded-full shadow-md hover:shadow-lg transform active:scale-95 border-b-4 border-yellow-600 transition-all text-sm md:text-lg">
            <i class="fas fa-sync-alt"></i>
            <span>NUEVO</span>
        </button>

        <!-- BotÃ³n Corregir -->
        <button onclick="checkAnswer()" class="action-btn flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold py-1.5 px-8 rounded-full shadow-md hover:shadow-lg transform active:scale-95 border-b-4 border-green-700 transition-all text-sm md:text-lg">
            <i class="fas fa-check"></i>
            <span>CORREGIR</span>
        </button>

    </footer>

    <!-- MODAL DE MENSAJE -->
    <div id="message-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 hidden backdrop-blur-sm">
        <div class="bg-white rounded-[2rem] p-8 text-center shadow-2xl border-4 border-blue-400 max-w-sm w-full mx-4 transform scale-100 animate-[bounce_0.5s_ease-out]">
            <div id="modal-icon" class="text-7xl mb-4 drop-shadow-md">ðŸŽ‰</div>
            <h2 id="modal-title" class="text-3xl font-bold text-blue-600 mb-2">Â¡Muy bien!</h2>
            <p id="modal-text" class="text-gray-600 text-lg mb-6 leading-relaxed">Lo has ordenado perfectamente.</p>
            <button onclick="closeModal()" class="bg-blue-500 text-white font-bold py-3 px-8 rounded-xl text-xl shadow-lg hover:bg-blue-600 hover:shadow-xl transform active:scale-95 transition-all w-full border-b-4 border-blue-700">
                Continuar
            </button>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÃ“N DE ALTURA PARA MÃ“VILES (Fallback JS) ---
        // A veces 100dvh no basta en navegadores antiguos, esto asegura compatibilidad
        function setAppHeight() {
            const doc = document.documentElement;
            doc.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();

        // --- ESTADO ---
        const state = {
            maxNumber: 99,
            quantity: 5,
            orderDesc: true, 
            numbers: [],
            isDragging: false
        };

        // --- REFERENCIAS ---
        const maxSelector = document.getElementById('max-selector');
        const qtySelector = document.getElementById('qty-selector');
        const qtyDisplay = document.getElementById('qty-val-display');
        const orderToggle = document.getElementById('order-toggle');
        const gameBoard = document.getElementById('game-board');
        const modal = document.getElementById('message-modal');

        // --- EVENTOS ---
        qtySelector.addEventListener('input', (e) => {
            state.quantity = parseInt(e.target.value);
            qtyDisplay.textContent = state.quantity;
            initGame();
        });

        maxSelector.addEventListener('change', (e) => {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 2) val = 2;
            if (val > 999) val = 999;
            e.target.value = val;
            state.maxNumber = val;
            initGame();
        });

        orderToggle.addEventListener('click', () => {
            state.orderDesc = !state.orderDesc;
            updateOrderUI();
        });

        function updateOrderUI() {
            const iconContainer = document.getElementById('order-icon');
            const textDisplay = document.getElementById('order-text');
            iconContainer.innerHTML = '';
            
            if (state.orderDesc) {
                textDisplay.textContent = "Mayor a Menor";
                iconContainer.innerHTML = `
                    <div class="w-1.5 h-4 bg-blue-600 rounded-sm"></div>
                    <div class="w-1.5 h-3 bg-blue-400 rounded-sm"></div>
                    <div class="w-1.5 h-2 bg-blue-200 rounded-sm"></div>
                    <i class="fas fa-arrow-right text-gray-400 text-[10px] ml-1"></i>
                `;
            } else {
                textDisplay.textContent = "Menor a Mayor";
                iconContainer.innerHTML = `
                    <div class="w-1.5 h-2 bg-blue-200 rounded-sm"></div>
                    <div class="w-1.5 h-3 bg-blue-400 rounded-sm"></div>
                    <div class="w-1.5 h-4 bg-blue-600 rounded-sm"></div>
                    <i class="fas fa-arrow-right text-gray-400 text-[10px] ml-1"></i>
                `;
            }
        }

        // --- LÃ“GICA JUEGO ---
        function generateRandomNumbers() {
            const nums = new Set();
            const maxPossible = state.maxNumber + 1;
            const targetQty = Math.min(state.quantity, maxPossible);
            while(nums.size < targetQty) {
                nums.add(Math.floor(Math.random() * (state.maxNumber + 1)));
            }
            return Array.from(nums);
        }

        function colorizeNumber(num) {
            const str = num.toString();
            let html = '';
            const len = str.length;
            for (let i = 0; i < len; i++) {
                const digit = str[i];
                const place = len - 1 - i; 
                let colorClass = 'text-gray-700'; 
                if (place === 0) colorClass = 'text-blue-600'; 
                else if (place === 1) colorClass = 'text-red-500'; 
                else if (place === 2) colorClass = 'text-green-600'; 
                html += `<span class="${colorClass}">${digit}</span>`;
            }
            return html;
        }

        function initGame() {
            gameBoard.innerHTML = '';
            state.numbers = generateRandomNumbers();
            
            state.numbers.forEach(num => {
                const el = document.createElement('div');
                
                // DEFINICIÃ“N DE CLASES RESPONSIVE (AQUÃ ESTÃ LA CLAVE DEL TAMAÃ‘O)
                // Mobile: w-16 h-20 text-3xl
                // Tablet/Laptop (md/lg): w-24 h-32 text-5xl
                // Monitor 2K / Pizarra (xl/2xl): w-40 h-56 text-7xl 
                let baseClasses = 'draggable-item bg-white border-2 md:border-4 border-blue-200 rounded-xl md:rounded-2xl shadow-lg font-bold select-none relative transition-all duration-300';
                
                // TamaÃ±os Base
                let sizeClasses = 'w-16 h-20 text-3xl'; // MÃ³vil Vertical
                sizeClasses += ' md:w-28 md:h-40 md:text-6xl'; // Tablet/Laptop standard
                sizeClasses += ' xl:w-40 xl:h-52 xl:text-7xl'; // Monitor Grande 1080p/2K
                sizeClasses += ' 2xl:w-48 2xl:h-64 2xl:text-8xl'; // Pizarras 4K / Pantallas muy grandes

                // Ajuste si hay muchas fichas para que no se salgan
                if (state.quantity > 7) {
                    sizeClasses = 'w-14 h-18 text-2xl';
                    sizeClasses += ' md:w-20 md:h-28 md:text-4xl';
                    sizeClasses += ' xl:w-32 xl:h-44 xl:text-6xl';
                    sizeClasses += ' 2xl:w-40 2xl:h-52 2xl:text-7xl';
                }

                el.className = `${baseClasses} ${sizeClasses}`;
                el.innerHTML = colorizeNumber(num);
                el.dataset.value = num;
                el.setAttribute('draggable', 'true');

                addDragEvents(el);
                gameBoard.appendChild(el);
            });
            closeModal();
        }

        // --- DRAG & DROP ---
        let dragSrcEl = null;

        function addDragEvents(el) {
            el.addEventListener('dragstart', handleDragStart);
            el.addEventListener('dragover', handleDragOver);
            el.addEventListener('dragenter', handleDragEnter);
            el.addEventListener('dragleave', handleDragLeave);
            el.addEventListener('drop', handleDrop);
            el.addEventListener('dragend', handleDragEnd);
            el.addEventListener('touchstart', handleTouchStart, {passive: false});
            el.addEventListener('touchmove', handleTouchMove, {passive: false});
            el.addEventListener('touchend', handleTouchEnd);
        }

        function handleDragStart(e) {
            this.style.opacity = '0.4';
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) { this.classList.add('scale-105', 'border-blue-500', 'z-50'); }
        function handleDragLeave(e) { this.classList.remove('scale-105', 'border-blue-500', 'z-50'); }

        function handleDrop(e) {
            if (e.stopPropagation) e.stopPropagation();
            if (dragSrcEl !== this) swapElements(dragSrcEl, this);
            return false;
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
            resetStyles();
        }

        let selectedTouchEl = null;
        function handleTouchStart(e) {
            const el = this;
            if (!selectedTouchEl) {
                selectedTouchEl = el;
                el.classList.add('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                playSound('select');
            } else {
                if (selectedTouchEl === el) {
                    selectedTouchEl.classList.remove('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                    selectedTouchEl = null;
                } else {
                    swapElements(selectedTouchEl, el);
                    selectedTouchEl.classList.remove('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                    selectedTouchEl = null;
                }
            }
        }
        function handleTouchMove(e) { e.preventDefault(); }
        function handleTouchEnd(e) {}

        function swapElements(el1, el2) {
            const srcVal = el1.dataset.value;
            const srcHTML = el1.innerHTML;
            const destVal = el2.dataset.value;
            const destHTML = el2.innerHTML;

            el1.innerHTML = destHTML;
            el1.dataset.value = destVal;
            el2.innerHTML = srcHTML;
            el2.dataset.value = srcVal;
            
            el1.classList.add('scale-110');
            setTimeout(() => el1.classList.remove('scale-110'), 200);
            playSound('pop');
        }

        function resetStyles() {
            [].forEach.call(document.querySelectorAll('.draggable-item'), function (col) {
                col.classList.remove('scale-105', 'border-blue-500', 'z-50');
            });
        }

        // --- CORRECCIÃ“N ---
        function checkAnswer() {
            const currentElements = Array.from(gameBoard.children);
            const currentValues = currentElements.map(el => parseInt(el.dataset.value));
            const sortedValues = [...currentValues].sort((a, b) => state.orderDesc ? b - a : a - b);

            let errors = 0;
            currentElements.forEach((el, index) => {
                const val = parseInt(el.dataset.value);
                el.classList.remove('correct', 'incorrect');
                void el.offsetWidth;
                if (val === sortedValues[index]) el.classList.add('correct');
                else {
                    el.classList.add('incorrect');
                    errors++;
                }
            });

            if (errors === 0) {
                playSound('success');
                showModal('Â¡FantÃ¡stico!', 'Has ordenado todos los nÃºmeros correctamente.', 'ðŸŽ‰');
            } else {
                playSound('error');
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else if (document.exitFullscreen) document.exitFullscreen();
        }

        function showModal(title, text, icon) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-text').innerText = text;
            document.getElementById('modal-icon').innerText = icon;
            modal.classList.remove('hidden');
        }
        function closeModal() { modal.classList.add('hidden'); }

        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const t = audioCtx.currentTime;

            if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, t);
                osc.frequency.exponentialRampToValueAtTime(300, t + 0.1);
                gainNode.gain.setValueAtTime(0.5, t);
                gainNode.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                osc.start(t);
                osc.stop(t + 0.1);
            } else if (type === 'select') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, t);
                gainNode.gain.setValueAtTime(0.3, t);
                gainNode.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                osc.start(t);
                osc.stop(t + 0.1);
            } else if (type === 'success') {
                const frequencies = [523.25, 659.25, 783.99]; 
                frequencies.forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.type = 'sine';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.2, t + (i*0.1));
                    g.gain.exponentialRampToValueAtTime(0.01, t + 0.6 + (i*0.1));
                    o.start(t + (i*0.1));
                    o.stop(t + 0.6 + (i*0.1));
                });
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, t);
                osc.frequency.linearRampToValueAtTime(150, t + 0.3);
                gainNode.gain.setValueAtTime(0.3, t);
                gainNode.gain.linearRampToValueAtTime(0.01, t + 0.3);
                osc.start(t);
                osc.stop(t + 0.3);
            }
        }

        updateOrderUI();
        initGame();
    </script>
</body>
</html>
