<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ordenando N칰meros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Importaci칩n de la fuente subida */
        @font-face {
            font-family: 'Escolar';
            src: url('Escolar_N.TTF');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Escolar', 'Comic Sans MS', sans-serif;
            background-color: #f0f9ff;
            overflow: hidden; /* Evitar scroll */
            touch-action: none; /* Mejorar respuesta t치ctil */
            user-select: none;
        }

        /* Estilos para los n칰meros arrastrables */
        .draggable-item {
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
            touch-action: none;
        }

        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.05);
            z-index: 50;
        }

        .draggable-item.dragging {
            opacity: 0.5;
            border: 4px dashed #cbd5e1;
        }

        /* Estados de correcci칩n */
        .correct {
            background-color: #dcfce7 !important; /* Verde claro */
            border-color: #22c55e !important;
            box-shadow: 0 0 15px #22c55e;
            animation: bounce 0.5s;
        }

        .incorrect {
            background-color: #fee2e2 !important; /* Rojo claro */
            border-color: #ef4444 !important;
            box-shadow: 0 0 15px #ef4444;
            animation: shake 0.5s;
        }

        /* Animaciones */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Estilo para los inputs de rango */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px; /* Reducido ligeramente */
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #bfdbfe;
            border-radius: 5px;
        }

        /* Contenedor principal de los n칰meros */
        #game-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0.5rem; /* Gap reducido para m칩vil */
            padding: 0.5rem;
            width: 100%;
            height: 100%; /* Ocupar altura disponible */
            align-content: center; /* Centrar verticalmente el contenido */
        }

        /* MEDIA QUERIES PARA M칍VIL HORIZONTAL (LANDSCAPE) */
        @media (max-height: 500px) and (orientation: landscape) {
            header {
                padding: 2px !important;
            }
            .header-controls {
                padding: 2px !important;
                gap: 8px !important;
            }
            .control-label {
                display: none !important; /* Ocultar etiquetas de texto para ganar altura */
            }
            footer {
                padding: 2px !important;
            }
            .action-btn {
                padding-top: 2px !important;
                padding-bottom: 2px !important;
                font-size: 0.8rem !important;
            }
            .draggable-item {
                /* Hacer las fichas un poco m치s compactas en landscape m칩vil */
                width: 3.5rem !important; 
                height: 4.5rem !important;
                font-size: 1.5rem !important;
                border-width: 2px !important;
            }
            /* Si hay muchos items, ajustamos m치s */
            .draggable-item-small {
                width: 2.5rem !important;
                height: 3.5rem !important;
                font-size: 1.2rem !important;
            }
            h2#instruction-overlay h2 {
                font-size: 1.5rem !important; /* Texto de fondo m치s peque침o */
            }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col bg-sky-100 text-slate-800 overflow-hidden">

    <!-- BARRA SUPERIOR (CONFIGURACI칍N) -->
    <!-- Se reduce padding vertical a p-1 -->
    <header class="bg-white shadow-md p-1 md:p-2 z-10 flex-none transition-all duration-300">
        <div class="max-w-7xl mx-auto flex justify-between items-center gap-2">
            
            <!-- T칤tulo (Oculto en m칩vil, visible en MD) -->
            <div class="hidden md:block font-bold text-xl text-blue-600 mr-4 whitespace-nowrap">
                <i class="fas fa-shapes"></i> Ordenando
            </div>

            <!-- Controles -->
            <div class="header-controls flex flex-1 flex-wrap justify-center items-center gap-2 md:gap-4 bg-blue-50 rounded-xl p-1 md:p-2 border border-blue-200">
                
                <!-- Rango M치ximo -->
                <div class="flex flex-col items-center justify-center min-w-[60px]">
                    <label class="control-label font-bold text-gray-600 text-[10px] md:text-xs mb-0.5">M치ximo</label>
                    <input type="number" id="max-selector" min="2" max="999" value="99" class="bg-white border border-blue-300 rounded-lg px-1 py-0.5 text-center font-bold text-blue-600 text-sm md:text-lg outline-none focus:ring-2 focus:ring-blue-400 w-16 md:w-24 shadow-sm" placeholder="99">
                </div>

                <!-- Cantidad de N칰meros -->
                <div class="flex flex-col items-center justify-center min-w-[80px]">
                    <label class="control-label font-bold text-gray-600 text-[10px] md:text-xs mb-0.5">Cant: <span id="qty-val-display" class="text-blue-600">5</span></label>
                    <input type="range" id="qty-selector" min="2" max="10" value="5" class="w-20 md:w-24">
                </div>

                <!-- Direcci칩n (Mayor/Menor) -->
                <div class="flex flex-col items-center justify-center">
                    <label class="control-label font-bold text-gray-600 text-[10px] md:text-xs mb-0.5">Orden</label>
                    <button id="order-toggle" class="flex items-center gap-1 md:gap-2 bg-white border-2 border-blue-400 px-2 py-0.5 md:px-3 md:py-1 rounded-full shadow-sm hover:bg-blue-50 transition-colors h-8 md:h-auto">
                        <!-- Icono din치mico -->
                        <div id="order-icon" class="flex items-end gap-0.5 md:gap-1 h-4 md:h-6">
                            <!-- Se llena por JS -->
                        </div>
                        <!-- Texto del bot칩n: Oculto en pantallas muy peque침as, visible en MD -->
                        <span id="order-text" class="hidden sm:inline font-bold text-[10px] md:text-sm">Mayor a Menor</span>
                    </button>
                </div>

            </div>

            <!-- Bot칩n Pantalla Completa -->
            <button onclick="toggleFullScreen()" class="flex-none bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full shadow transition w-8 h-8 md:w-10 md:h-10 flex items-center justify-center">
                <i class="fas fa-expand text-xs md:text-base"></i>
            </button>
        </div>
    </header>

    <!-- 츼REA DE JUEGO -->
    <main class="flex-grow flex flex-col justify-center items-center relative overflow-hidden w-full">
        
        <!-- Instrucci칩n visual grande -->
        <div id="instruction-overlay" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none opacity-50 z-0 w-full">
            <h2 class="text-2xl md:text-5xl font-bold text-blue-200 tracking-widest uppercase opacity-20 select-none">ARRASTRA</h2>
        </div>

        <!-- Contenedor de n칰meros (Drop Zone) -->
        <div id="game-board" class="z-10 relative">
            <!-- Los n칰meros se generar치n aqu칤 -->
        </div>

    </main>

    <!-- BARRA INFERIOR (ACCIONES) -->
    <!-- Reducido padding, botones en fila (row) en m칩vil para ahorrar altura -->
    <footer class="bg-white p-1 md:p-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] flex justify-center gap-2 md:gap-6 z-20 transition-all">
        
        <!-- Bot칩n Nuevo: Flex Row en movil, Col en Desktop -->
        <button onclick="initGame()" class="action-btn flex flex-row md:flex-col items-center justify-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-1 px-3 md:py-2 md:px-6 rounded-xl md:rounded-2xl shadow-md transform hover:scale-105 transition active:scale-95 border-b-2 md:border-b-4 border-yellow-600 text-sm md:text-base h-10 md:h-auto">
            <i class="fas fa-sync-alt text-lg md:text-2xl"></i>
            <span>NUEVO</span>
        </button>

        <!-- Bot칩n Corregir: Flex Row en movil, Col en Desktop -->
        <button onclick="checkAnswer()" class="action-btn flex flex-row md:flex-col items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-4 md:py-2 md:px-8 rounded-xl md:rounded-2xl shadow-md transform hover:scale-105 transition active:scale-95 border-b-2 md:border-b-4 border-green-700 text-sm md:text-base h-10 md:h-auto">
            <i class="fas fa-check text-lg md:text-2xl"></i>
            <span>CORREGIR</span>
        </button>

    </footer>

    <!-- MODAL DE MENSAJE -->
    <div id="message-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-6 md:p-8 text-center shadow-2xl border-4 border-blue-400 max-w-xs md:max-w-sm w-full mx-4 transform scale-100 animate-[bounce_0.5s_ease-out]">
            <div id="modal-icon" class="text-4xl md:text-6xl mb-2 md:mb-4">游꿀</div>
            <h2 id="modal-title" class="text-2xl md:text-3xl font-bold text-blue-600 mb-2">춰Muy bien!</h2>
            <p id="modal-text" class="text-gray-600 text-base md:text-lg mb-4 md:mb-6">Lo has ordenado perfectamente.</p>
            <button onclick="closeModal()" class="bg-blue-500 text-white font-bold py-2 md:py-3 px-6 md:px-8 rounded-full text-lg md:text-xl shadow-md hover:bg-blue-600 w-full">
                Continuar
            </button>
        </div>
    </div>

    <script>
        // --- ESTADO DE LA APP ---
        const state = {
            maxNumber: 99,
            quantity: 5,
            orderDesc: true, 
            numbers: [],
            isDragging: false
        };

        // --- REFERENCIAS DOM ---
        const maxSelector = document.getElementById('max-selector');
        const qtySelector = document.getElementById('qty-selector');
        const qtyDisplay = document.getElementById('qty-val-display');
        const orderToggle = document.getElementById('order-toggle');
        const gameBoard = document.getElementById('game-board');
        const modal = document.getElementById('message-modal');

        // --- INICIALIZACI칍N Y EVENTOS ---
        
        qtySelector.addEventListener('input', (e) => {
            state.quantity = parseInt(e.target.value);
            qtyDisplay.textContent = state.quantity;
            initGame();
        });

        maxSelector.addEventListener('change', (e) => {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 2) val = 2;
            if (val > 999) val = 999;
            e.target.value = val;
            state.maxNumber = val;
            initGame();
        });

        orderToggle.addEventListener('click', () => {
            state.orderDesc = !state.orderDesc;
            updateOrderUI();
            updateInstructionOverlay();
        });

        function updateOrderUI() {
            const iconContainer = document.getElementById('order-icon');
            const textDisplay = document.getElementById('order-text');
            
            iconContainer.innerHTML = '';
            
            if (state.orderDesc) {
                textDisplay.textContent = "Mayor a Menor";
                iconContainer.innerHTML = `
                    <div class="w-1.5 md:w-2 h-4 md:h-5 bg-blue-600 rounded-sm"></div>
                    <div class="w-1.5 md:w-2 h-2.5 md:h-3 bg-blue-400 rounded-sm"></div>
                    <div class="w-1.5 md:w-2 h-1 bg-blue-200 rounded-sm"></div>
                    <i class="fas fa-arrow-right text-gray-400 text-[10px] ml-0.5 self-center"></i>
                `;
            } else {
                textDisplay.textContent = "Menor a Mayor";
                iconContainer.innerHTML = `
                    <div class="w-1.5 md:w-2 h-1 bg-blue-200 rounded-sm"></div>
                    <div class="w-1.5 md:w-2 h-2.5 md:h-3 bg-blue-400 rounded-sm"></div>
                    <div class="w-1.5 md:w-2 h-4 md:h-5 bg-blue-600 rounded-sm"></div>
                    <i class="fas fa-arrow-right text-gray-400 text-[10px] ml-0.5 self-center"></i>
                `;
            }
        }

        function updateInstructionOverlay() {
            // Placeholder
        }

        // --- L칍GICA DEL JUEGO ---

        function generateRandomNumbers() {
            const nums = new Set();
            // Evitar bucle infinito si piden m치s n칰meros que el rango disponible
            const maxPossible = state.maxNumber + 1;
            const targetQty = Math.min(state.quantity, maxPossible);

            while(nums.size < targetQty) {
                const n = Math.floor(Math.random() * (state.maxNumber + 1));
                nums.add(n);
            }
            return Array.from(nums);
        }

        function colorizeNumber(num) {
            const str = num.toString();
            let html = '';
            const len = str.length;
            
            for (let i = 0; i < len; i++) {
                const digit = str[i];
                const place = len - 1 - i; 
                let colorClass = 'text-gray-800'; 
                if (place === 0) colorClass = 'text-blue-600'; 
                else if (place === 1) colorClass = 'text-red-500'; 
                else if (place === 2) colorClass = 'text-green-600'; 
                html += `<span class="${colorClass}">${digit}</span>`;
            }
            return html;
        }

        function initGame() {
            gameBoard.innerHTML = '';
            state.numbers = generateRandomNumbers();
            
            state.numbers.forEach(num => {
                const el = document.createElement('div');
                // Ajuste de clases para responsividad
                // Base: m치s peque침as para m칩vil. md: m치s grandes para desktop.
                let baseClasses = 'draggable-item bg-white border-2 md:border-4 border-blue-200 rounded-xl md:rounded-2xl shadow-md md:shadow-lg flex items-center justify-center font-bold select-none relative';
                
                // Tama침os
                // Mobile Portrait: w-16 h-20 text-3xl
                // Mobile Landscape: manejado por CSS @media (w-14 h-16 approx)
                // Desktop: w-24 h-32 o mayor
                
                let sizeClass = 'w-16 h-20 text-3xl md:w-24 md:h-32 md:text-5xl';
                if (state.quantity > 6) {
                    // Si hay muchas, reducimos un poco en desktop, en m칩vil ya son peque침as
                    sizeClass = 'w-14 h-18 text-2xl md:w-20 md:h-24 md:text-4xl';
                }

                el.className = `${baseClasses} ${sizeClass}`;
                
                el.innerHTML = colorizeNumber(num);
                el.dataset.value = num;
                el.setAttribute('draggable', 'true');

                addDragEvents(el);
                gameBoard.appendChild(el);
            });
            closeModal();
        }

        // --- DRAG & DROP & TOUCH SWAP ---

        let dragSrcEl = null;

        function addDragEvents(el) {
            el.addEventListener('dragstart', handleDragStart);
            el.addEventListener('dragover', handleDragOver);
            el.addEventListener('dragenter', handleDragEnter);
            el.addEventListener('dragleave', handleDragLeave);
            el.addEventListener('drop', handleDrop);
            el.addEventListener('dragend', handleDragEnd);

            el.addEventListener('touchstart', handleTouchStart, {passive: false});
            el.addEventListener('touchmove', handleTouchMove, {passive: false});
            el.addEventListener('touchend', handleTouchEnd);
        }

        function handleDragStart(e) {
            this.style.opacity = '0.4';
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            this.classList.add('scale-105', 'border-blue-500');
        }

        function handleDragLeave(e) {
            this.classList.remove('scale-105', 'border-blue-500');
        }

        function handleDrop(e) {
            if (e.stopPropagation) e.stopPropagation();
            if (dragSrcEl !== this) {
                swapElements(dragSrcEl, this);
            }
            return false;
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
            resetStyles();
        }

        let selectedTouchEl = null;

        function handleTouchStart(e) {
            const el = this;
            if (!selectedTouchEl) {
                selectedTouchEl = el;
                el.classList.add('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                playSound('select');
            } else {
                if (selectedTouchEl === el) {
                    selectedTouchEl.classList.remove('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                    selectedTouchEl = null;
                } else {
                    swapElements(selectedTouchEl, el);
                    selectedTouchEl.classList.remove('ring-4', 'ring-yellow-400', 'scale-105', 'z-50');
                    selectedTouchEl = null;
                }
            }
        }

        function handleTouchMove(e) { e.preventDefault(); }
        function handleTouchEnd(e) { }

        function swapElements(el1, el2) {
            const srcVal = el1.dataset.value;
            const srcHTML = el1.innerHTML;
            
            const destVal = el2.dataset.value;
            const destHTML = el2.innerHTML;

            el1.innerHTML = destHTML;
            el1.dataset.value = destVal;

            el2.innerHTML = srcHTML;
            el2.dataset.value = srcVal;
            
            playSound('pop');
        }

        function resetStyles() {
            [].forEach.call(document.querySelectorAll('.draggable-item'), function (col) {
                col.classList.remove('scale-105', 'border-blue-500');
            });
        }

        // --- CORRECCI칍N ---

        function checkAnswer() {
            const currentElements = Array.from(gameBoard.children);
            const currentValues = currentElements.map(el => parseInt(el.dataset.value));
            
            const sortedValues = [...currentValues].sort((a, b) => {
                return state.orderDesc ? b - a : a - b;
            });

            let errors = 0;

            currentElements.forEach((el, index) => {
                const val = parseInt(el.dataset.value);
                el.classList.remove('correct', 'incorrect');
                void el.offsetWidth;

                if (val === sortedValues[index]) {
                    el.classList.add('correct');
                } else {
                    el.classList.add('incorrect');
                    errors++;
                }
            });

            if (errors === 0) {
                playSound('success');
                showModal('춰Fant치stico!', 'Has ordenado todos los n칰meros correctamente.', '游꿀');
            } else {
                playSound('error');
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function showModal(title, text, icon) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-text').innerText = text;
            document.getElementById('modal-icon').innerText = icon;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            const t = audioCtx.currentTime;

            if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, t);
                osc.frequency.exponentialRampToValueAtTime(300, t + 0.1);
                gainNode.gain.setValueAtTime(0.5, t);
                gainNode.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                osc.start(t);
                osc.stop(t + 0.1);
            } else if (type === 'select') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, t);
                gainNode.gain.setValueAtTime(0.3, t);
                gainNode.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                osc.start(t);
                osc.stop(t + 0.1);
            } else if (type === 'success') {
                const frequencies = [523.25, 659.25, 783.99]; 
                frequencies.forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.type = 'sine';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.2, t + (i*0.1));
                    g.gain.exponentialRampToValueAtTime(0.01, t + 0.6 + (i*0.1));
                    o.start(t + (i*0.1));
                    o.stop(t + 0.6 + (i*0.1));
                });
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, t);
                osc.frequency.linearRampToValueAtTime(150, t + 0.3);
                gainNode.gain.setValueAtTime(0.3, t);
                gainNode.gain.linearRampToValueAtTime(0.01, t + 0.3);
                osc.start(t);
                osc.stop(t + 0.3);
            }
        }

        updateOrderUI();
        initGame();

    </script>
</body>
</html>
